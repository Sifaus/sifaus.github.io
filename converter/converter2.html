<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Converter</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<meta http-equiv="cache-control" content="max-age=0" />
		<meta http-equiv="cache-control" content="no-cache" />
		<meta http-equiv="expires" content="0" />
		<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
		<meta http-equiv="pragma" content="no-cache" />
		<style> textarea { width: 100%; } </style>
		<script type="text/javascript">
			var textbox = '';
			var finished = '';
			var original = '';
			var array_type = 4;
			var rows = [];

			function convert_it(converter) {
				textbox = document.getElementById('textbox').value;
				var lines = textbox.split("\n\r");
				var lines = textbox.split("\r\n");
				var lines = textbox.split("\r");
				var lines = textbox.split("\n");
				var product = "";

				if (converter == 2) {
					var thissetting = "";

					for (var eh = 0; eh < lines.length; eh++) {
						if (lines[eh][0] == "v") {
							thissetting = lines[eh].substring(4).replace(" = [", "");
							var asd = "\r\n\r\n######################### " + thissetting.toUpperCase() + " #########################\r\n";
							product += asd;
						}
						else if (lines[eh][0] == "]") {}
						else {
							var assArray = {
								name: "",
								stock: "",
								type: "",
								cost: -1,
								desc: "",
								allowed: [],
								disabled: false
							};

							lines[eh] = lines[eh].substring(2);
							lines[eh] = lines[eh].replace("]],", "]");
							lines[eh] = lines[eh].replace("]]", "]");

							var remainingString = lines[eh];
							
							assArray["name"] = remainingString.slice(1, remainingString.indexOf('"', 1));
							remainingString = remainingString.substring(remainingString.indexOf('"', 1) + 3);
							console.log("name: " + assArray["name"])
					
							var data = ["stock", "type"];
							for (var i = 0; i < data.length; i++) {
								assArray[data[i]] = remainingString.slice(1, remainingString.indexOf('"', 1));
								remainingString = remainingString.substring(remainingString.indexOf('"', 1) + 3);
								console.log(data[i] + ": " + assArray[data[i]])
							}
							
							assArray["cost"] = parseInt(remainingString.slice(0, remainingString.indexOf(',', 0)));
							remainingString = remainingString.substring(remainingString.indexOf('"', 0));
							console.log("cost: " + assArray["cost"])

							assArray["desc"] = remainingString.slice(1, remainingString.indexOf('"', 1));
							remainingString = remainingString.substring(remainingString.indexOf('"', 1) + 4);
							console.log("desc: " + assArray["desc"])

							console.log("remaining: " + remainingString)
							remainingString = remainingString.slice(0, -1).split(", ");

							console.log("remaining: " + remainingString)
							assArray["allowed"] = remainingString;
							console.log("allowed: " + assArray["allowed"])

							remainingString = "";

							console.log("remaining: " + remainingString)
							final = JSON.stringify(assArray) + ",\r\n";
							product += final.replace(/\\"/g, '');
						}
					
					}
				}
				if (converter == 1) {
					var thissetting = "";

					for (var eh = 0; eh < lines.length; eh++) {
						if (lines[eh][0] == "v") {
							thissetting = lines[eh].substring(4).replace(" = [", "");
							var asd = "\r\n\r\n######################### " + thissetting.toUpperCase() + " #########################\r\n";
							product += asd;
						}
						else if (lines[eh][0] == "]") {}
						else {
							var assArray = {
								name: "",
								magical: -1,
								training: -1,
								type: "",
								root: "",
								tools: "",
								desc: "",
								noList: false,
								allowed: [],
								disabled: false,
								restriction: ""
							};

							lines[eh] = lines[eh].substring(2);
							lines[eh] = lines[eh].replace("]],", "]");
							lines[eh] = lines[eh].replace("]]", "]");

							var remainingString = lines[eh];
							
							assArray["name"] = remainingString.slice(1, remainingString.indexOf('"', 1));
							remainingString = remainingString.substring(remainingString.indexOf('"', 1) + 3);
							//console.log("name: " + assArray["name"])
							
							var basics = ["magical", "training"];
							for (var i = 0; i < basics.length; i++) {
								assArray[basics[i]] = Boolean(remainingString.slice(0, remainingString.indexOf(',', 0)));
								remainingString = remainingString.substring(remainingString.indexOf(',', 0) + 2);
								//console.log(basics[i] + ": " + assArray[basics[i]])
							}
							
							var data = ["restriction", "type", "root", "tools", "desc"];
							for (var i = 0; i < data.length; i++) {
								assArray[data[i]] = remainingString.slice(1, remainingString.indexOf('"', 1));
								remainingString = remainingString.substring(remainingString.indexOf('"', 1) + 3);
								//console.log(data[i] + ": " + assArray[data[i]])
							}
							
							assArray["noList"] = Boolean(remainingString.slice(0, remainingString.indexOf(',', 0)));
							remainingString = remainingString.substring(remainingString.indexOf('"', 0));
							//console.log("noList: " + assArray["noList"])

							remainingString = remainingString.slice(0, -1).split(", ");

							assArray["allowed"] = remainingString;
							//console.log("allowed: " + assArray["allowed"])

							remainingString = "";

							//console.log("remaining: " + remainingString)
							final = JSON.stringify(assArray) + ",\r\n";
							product += final.replace(/\\"/g, '');
						}
					}
				}
				if (converter == 0) {
					var thisstock = document.getElementById('stockname').value;
					var thissetting = document.getElementById('settingname').value;

					for (var eh = 0; eh < lines.length; eh++) {
						if (lines[eh][0] == "v") {
							thissetting = lines[eh].substring(4 + thisstock.length).replace(" = [", "");
							var asd = "\r\n\r\n######################### " + thisstock.toUpperCase() + " " + thissetting.toUpperCase() + " #########################\r\n";
							product += asd;
						}
						else if (lines[eh][0] == "]") { }
						else {
							var assArray = {
								name: "",
								years: -1,
								resources: -1,
								mentalPool: -1,
								physicalPool: -1,
								eitherPool: -1,
								generalSkillPool: -1,
								skillPool: -1,
								traitPool: -1,
								skills: [],
								traits: [],
								leads: [],
								requirements: "",
								born: -1,
								allowed: [],
								disabled: false,
								selectable: true,
								setting: thissetting,
								stock: thisstock
							};

							lines[eh] = lines[eh].substring(2);
							lines[eh] = lines[eh].replace("]],", "]");
							lines[eh] = lines[eh].replace("]]", "]");
							//console.log(lines[eh])

							var remainingString = lines[eh];

							assArray["name"] = remainingString.slice(1, remainingString.indexOf('"', 1));
							remainingString = remainingString.substring(remainingString.indexOf('"', 1) + 3);
							//console.log("name: " + assArray["name"])

							var basics = ["years", "resources", "mentalPool", "physicalPool", "eitherPool", "generalSkillPool", "skillPool", "traitPool"];
							for (var i = 0; i < basics.length; i++) {
								assArray[basics[i]] = parseInt(remainingString.slice(0, remainingString.indexOf(',', 0)));
								remainingString = remainingString.substring(remainingString.indexOf(',', 0) + 2);
								//console.log(basics[i] + ": " + assArray[basics[i]])
							}

							var lists = ["skills", "traits", "leads"];
							for (var i = 0; i < lists.length; i++) {
								assArray[lists[i]] = remainingString.slice(1, remainingString.indexOf('"', 1)).split(',');
								remainingString = remainingString.substring(remainingString.indexOf('"', 1) + 3);
								//console.log(lists[i] + ": " + assArray[lists[i]])
							}

							assArray["requirements"] = remainingString.slice(1, remainingString.indexOf('"', 1));
							remainingString = remainingString.substring(remainingString.indexOf('"', 1) + 3);
							//console.log("requirements: " + assArray["requirements"])

							remainingString = remainingString.substring(8);

							assArray["born"] = parseInt(remainingString.slice(0, remainingString.indexOf(',', 0)));
							remainingString = remainingString.substring(remainingString.indexOf('"', 0));
							//console.log("born: " + assArray["born"])

							remainingString = remainingString.slice(0, -1).split(", ");

							assArray["allowed"] = remainingString;
							//console.log("allowed: " + assArray["allowed"])

							remainingString = "";

							//console.log("remaining: " + remainingString)
							final = JSON.stringify(assArray) + ",\r\n";
							product += final.replace(/\\"/g, '');
						}
					}
				}
					
				document.getElementById('textbox').value = product;
			}
		</script>
	</head>
	<body>
		<textarea name="textbox" id="textbox" rows="36" autofocus="autofocus"></textarea>
		<input type="text" id="stockname" value="Man">
		<input type="text" id="settingname" value="Peasant">
		<div id="array_options" style="display:block">
			<br>
			Surround With:
			<input type="radio" name="quote" id="double_quote" checked onclick="convert_it(array_type)"><label for="double_quote">
				" </label>
			<input type="radio" name="quote" id="single_quote" onclick="convert_it(array_type)"><label for="single_quote"> '
			</label>
			<br>
			<input type="checkbox" id="newlines" value="1" checked onclick="convert_it(array_type)"><label for="newlines">Keep
				newlines</label>
			<br>
			<input type="checkbox" id="blank_fields" value="1" onclick="convert_it(array_type)"><label for="blank_fields">Remove
				blank fields</label>
			<br>
			<input type="checkbox" id="numbers_to_string" value="1" onclick="convert_it(array_type)"><label for="numbers_to_string">Convert
				numbers to strings</label>
			<br>
			<input type="checkbox" id="row_headers" value="1" checked onclick="convert_it(1)"><label for="row_headers">First top
				row contains headers</label>
			<br>
			<input type="checkbox" id="col_headers" value="1" onclick="convert_it(1)"><label for="col_headers">First left column
				contains headers</label>
			<br>
			<input type="radio" name="keys" id="top" checked onclick="convert_it(3)"><label for="top">Top Row</label>
			<input type="radio" name="keys" id="left" onclick="convert_it(3)"><label for="left">Left Column</label>
		</div>
		<input type="button" name="convert" value="Convert to Lifepath List" onclick="convert_it(0);">
		<input type="button" name="convert" value="Convert to Skill List" onclick="convert_it(1);">
		<input type="button" name="convert" value="Convert to Trait List" onclick="convert_it(2);">
	</body>
</html>