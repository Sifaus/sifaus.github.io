const canvas=document.getElementById("Canvas"),context=canvas.getContext("2d"),wheel_image=document.getElementById("wheel-img"),font_image=document.getElementById("font-img"),font_data=["Y","Q","V","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","R","S","T","U","W","X","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"," "],char_width=14,char_height=20,center_x=295,center_y=center_x,max_radius=285,elements_prime=["Air","Earth","Fire","Water","White"],elements_lower=["Anima","Leta","Simulacra","Vita"],elements_higher=["Arcane","Light","Shadow"],data_elements=["starting-law","starting-aoe","starting-duration","starting-elements-prime","starting-elements-lower","starting-elements-higher","starting-origin"];var rotation_interval,interval_running=!1,hiding=!1,circles={laws:{color:"#444444",radius:max_radius,angle_per_part:0,current_step:0,target_step:0,speed:0,rotation_done:!1,html_element:"starting-law",parts:["Alteration","Assertion","Conjuration","Destruction","Exaltation","Reduction","Transmutation"]},areas_of_effect:{color:"#555555",radius:max_radius-40,angle_per_part:0,current_step:0,target_step:0,speed:0,rotation_done:!1,html_element:"starting-aoe",parts:["Caster","Single Target","Presence","Natural Effect","Measured Area"]},durations:{color:"#666666",radius:max_radius-80,angle_per_part:0,current_step:0,target_step:0,speed:0,rotation_done:!1,html_element:"starting-duration",parts:["Instantaneous","Sustained","Elapsed Time","Permanent"]},elements:{color:"#777777",radius:max_radius-120,angle_per_part:0,current_step:0,target_step:0,speed:0,rotation_done:!1,html_element:"starting-elements-prime",element_category:"prime",parts:["Air","Earth","Fire","Water","White"]},origins:{color:"#888888",radius:max_radius-160,angle_per_part:0,current_step:0,target_step:0,speed:0,rotation_done:!1,html_element:"starting-origin",parts:["Personal","Presence","Sight"]}};document.addEventListener("DOMContentLoaded",function(){loadCircles()});function loadCircles(){for(let a in circles)circles[a].angle_per_part=2*Math.PI/circles[a].parts.length;font_image.onload=function(){drawCircles()}}function changeCategory(){let a=document.getElementById("element-category").value;for(let a=0;a<data_elements.length;a++)document.getElementById(data_elements[a]).value=0,document.getElementById(data_elements[a]).getAttribute("prev-value").value=0;for(let b in document.getElementById("starting-elements-prime").style.display="none",document.getElementById("starting-elements-lower").style.display="none",document.getElementById("starting-elements-higher").style.display="none",0==a?(circles.elements.element_category="prime",circles.elements.parts=elements_prime):1==a?(circles.elements.element_category="lower",circles.elements.parts=elements_lower):2==a&&(circles.elements.element_category="higher",circles.elements.parts=elements_higher),circles.elements.html_element="starting-elements-"+circles.elements.element_category,document.getElementById(circles.elements.html_element).style.display="inline-block",circles)circles[b].current_step=0,circles[b].angle_per_part=2*Math.PI/circles[b].parts.length;drawCircles()}function changeStart(){if(!interval_running&&"undefined"==typeof rotation_interval){for(let a in circles){let b=circles[a].html_element;document.getElementById(b).getAttribute("prev-value").value=document.getElementById(b).value,circles[a].current_step=document.getElementById(b).value}drawCircles()}else for(let a in circles){let b=circles[a].html_element;document.getElementById(b).value=document.getElementById(b).getAttribute("prev-value")}}function switchHiding(){hiding=!hiding,drawCircles()}function switchSettings(){let a=document.getElementById("settings").style.display;"block"==a?(document.getElementById("settings").style.display="none",document.getElementById("switchSettings").value="Show Settings"):(document.getElementById("settings").style.display="block",document.getElementById("switchSettings").value="Hide Settings")}function startRotation(){if(!interval_running&&"undefined"==typeof rotation_interval){interval_running=!0;let a="true"==document.getElementById("direction").value,b=parseInt(document.getElementById("steps").value);for(let c in a&&(b*=-1),circles)circles[c].target_step=circles[c].current_step-b,circles[c].speed=b*(2*Math.random()+1)/(50*Math.abs(b)*circles[c].angle_per_part);rotation_interval=setInterval(rotationInterval,16,b)}}function rotationInterval(a){let b=0;for(let b in circles)if(circles[b].current_step-=circles[b].speed,0>a&&circles[b].current_step>=circles[b].target_step){for(circles[b].current_step=circles[b].target_step;circles[b].target_step>circles[b].parts.length-1;)circles[b].target_step-=circles[b].parts.length;for(;circles[b].current_step>circles[b].parts.length-1;)circles[b].current_step-=circles[b].parts.length;circles[b].rotation_done=!0}else if(0<a&&circles[b].current_step<=circles[b].target_step){for(circles[b].current_step=circles[b].target_step;0>circles[b].target_step;)circles[b].target_step+=circles[b].parts.length;for(;0>circles[b].current_step;)circles[b].current_step+=circles[b].parts.length;circles[b].rotation_done=!0}for(let c in circles)circles[c].rotation_done&&b++;if(5==b)for(let a in clearInterval(rotation_interval),rotation_interval=void 0,interval_running=!1,circles)document.getElementById(circles[a].html_element).value=circles[a].current_step,circles[a].rotation_done=!1;drawCircles()}function drawCircles(){for(let a in circles)context.beginPath(),context.arc(center_x,center_y,circles[a].radius,0,6.28318),context.closePath(),context.fillStyle=circles[a].color,context.fill();drawWedge(),drawText(),hiding&&drawHideWedge(),drawDeadCircle()}function drawText(){for(let a in circles)for(let b=0;b<circles[a].parts.length;b++)drawTextAlongArc(circles[a].parts[b],circles[a].radius,12/circles[a].radius,circles[a].angle_per_part*(-1*circles[a].current_step+b),6*(circles[a].parts[b].length+2)/circles[a].radius)}function drawTextAlongArc(a,b,c,d,e){context.save(),context.translate(center_x,center_y),context.rotate(d-e);for(let f=0;f<a.length;f++)context.rotate(c),context.save(),context.translate(0,-1*b+11),context.drawImage(font_image,font_data.indexOf(a[f])*char_width,0,char_width,char_height,0,0,char_width-2,char_height),context.restore();context.restore()}function drawDeadCircle(){context.beginPath(),context.arc(center_x,center_y,85,0,6.28318),context.closePath(),context.fillStyle="#999999",context.fill(),context.save(),context.clip(),context.drawImage(wheel_image,210,208,170,170),context.restore()}function drawWedge(){context.save(),context.beginPath(),context.arc(center_x,center_y,max_radius,4.18879,5.23599),context.lineTo(center_x,center_y),context.closePath(),context.globalAlpha=.1,context.fillStyle="#FFFFFF",context.fill(),context.restore()}function drawHideWedge(){context.beginPath(),context.arc(center_x,center_y,max_radius+1,5.23599,4.18879),context.lineTo(center_x,center_y),context.closePath(),context.fillStyle="#2d2d2d",context.fill()}